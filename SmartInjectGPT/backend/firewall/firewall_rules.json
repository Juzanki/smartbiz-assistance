# === prompt_firewall.ps1 ===
param (
    [string]$PromptText
)

$rulesPath = "$PSScriptRoot\..\firewall\firewall_rules.json"

if (-not (Test-Path $rulesPath)) {
    Write-Host "`n‚ùå ERROR: Firewall rules not found at $rulesPath" -ForegroundColor Red
    exit 1
}

# Load rules
$rules = Get-Content -Raw -Path $rulesPath | ConvertFrom-Json
$blocked = $rules.blocked_keywords

# Normalize prompt to lowercase and trim
$normalizedPrompt = $PromptText.ToLower().Trim()

foreach ($keyword in $blocked) {
    $pattern = $keyword.ToLower().Trim()
    if ($normalizedPrompt -like "*$pattern*") {
        Write-Host "`n‚õî BLOCKED: Prompt contains banned keyword ‚û§ '$keyword'" -ForegroundColor Red
        Write-Host "üßæ Prompt: `"$PromptText`"" -ForegroundColor DarkGray
        exit 1
    }
}

Write-Host "`n‚úÖ Prompt passed üîê firewall checks." -ForegroundColor Green
